---
hosts:
  najjarza.de:
    Hostname: de.najjarza.de
    Port: 54323
    Aliases: 
      - de
      - mail

  # ir.najjarza.de:
  #   Hostname: ir.najjarza.de
  #   Aliases:
  #     - ir

  # ir-de-gw0:
  #   Hostname: localhost
  #   Port: 54323
  #   Aliases: 
  #     - de
  #     #Inherits: ir
  #   Gateways:
  #     - direct
  #     - ir

  # ir-proxy:
  #   DynamicForward: 1083
  #   ExitOnForwardFailure: yes
  #   Inherits: ir

  # ir-tun0:
  #   RemoteForward: 10001 localhost:22
  #   ExitOnForwardFailure: yes
  #   Inherits: ir

  de-proxy:
    DynamicForward: 1080
    ExitOnForwardFailure: yes
    Inherits: de

  de-tun0:
    RemoteForward: 10001 localhost:22
    ExitOnForwardFailure: yes
    Inherits: de


defaults:
  # Defaults are applied to each hosts
  Port: 22
  User: dariush
  IdentityFile: ~/.ssh/id_ed25519
  ControlMaster: auto
  ControlPath: ~/tmp/.ssh/cm/%h-%p-%r.sock
  ControlPersist: yes
  ServerAliveInterval: 240
  ServerAliveCountMax: 2
  TCPKeepAlive: yes
  IgnoreUnknown: AddKeysToAgent,UseKeychain
  AddKeysToAgent: yes
  UseKeychain: yes
  Hooks:
    # Automatically backup ~/.ssh/config
    BeforeConfigWrite:
      - 'exec set -x; cp {{.SSHConfigPath}} {{.SSHConfigPath}}.bkp'

    AfterConfigWrite:
      # Concat another `ssh_config` file with the one just generated by `assh`
      #- 'exec cat ~/.ssh/my-heroku-generated-config >> {{.SSHConfigPath}}'

      # Alert me with a Desktop notification
      - notify "{{.SSHConfigPath}} has been rewritten"

    OnConnect:
      # Log internal information to a file
      - exec printf '{{.}}' | jq . >> ~/.ssh/last_connected_host.txt

      # Alert me with a Desktop notification
      - notify New SSH connection to {{.Host.Prototype}} at {{.Stats.ConnectedAt}}

      # Write the host prototype to the terminal stderr
      - write New SSH connection to {{.Host.Prototype}}

    OnDisconnect:
      # write on terminal and in a Desktop notification some statistics about the finished connection
      - "write  SSH connection to {{.Host.HostName}} closed, {{.Stats.WrittenBytes }} bytes written in {{.Stats.ConnectionDuration}} ({{.Stats.AverageSpeed}}bps)"
      - "notify SSH connection to {{.Host.HostName}} closed, {{.Stats.WrittenBytes }} bytes written in {{.Stats.ConnectionDuration}} ({{.Stats.AverageSpeed}}bps)"
    
includes:
- ~/.ssh/assh.d/*.yml

ASSHBinaryPath: /usr/local/bin/assh  # optionally set the path of assh
